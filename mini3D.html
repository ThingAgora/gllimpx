<html>

<head>
<title>mini3D</title>
<link rel="stylesheet" type="text/css" href="/css/luc.css" />

<script type="text/javascript" src="matrix.js"></script>
<script type="text/javascript" src="vector.js"></script>
<script type="text/javascript" src="matrix3D.js"></script>
<script type="text/javascript" src="vector3D.js"></script>
<script type="text/javascript" src="mesh.js"></script>
<script type="text/javascript" src="object3D.js"></script>
<script type="text/javascript" src="box.js"></script>
<script type="text/javascript" src="polySphere.js"></script>
<script type="text/javascript" src="polyCylinder.js"></script>
<script type="text/javascript" src="polyCone.js"></script>
<script type="text/javascript" src="x3d.js"></script>

<script type="text/javascript">

var scene, model, canvas, gc, outLog, xmlDoc, xmlhttp;

var deltaZ, dragX, dragY;

function mousedown(event) {
	dragX = event.clientX;
	dragY = event.clientY;
}

function mousemove(event) {
  if (scene && model && dragX && dragY) {
	var deltaX = (event.clientX - dragX) * 2 * Math.PI / canvas.width;
	var deltaY = (dragY - event.clientY) * 2 * Math.PI / canvas.height;
	model.transformation = model.transformation.mul(
		Matrix3D.rotationY(deltaX).mul(
			Matrix3D.rotationX(deltaY)));
  	scene.update(canvas.width / 2,canvas.width,canvas.height);
  	gc.clearRect(0,0,canvas.width,canvas.height);
  	scene.paint(gc);  
	dragX = event.clientX;
	dragY = event.clientY;
  }
}

function mouseup(event) {
	dragX = dragY = 0;
}

function doAjaxQuery(method, url) {
  xmlhttp=new XMLHttpRequest();
  xmlhttp.onreadystatechange=function() {
		if (xmlhttp.readyState==4 && xmlhttp.status==200) {
			var parser=new DOMParser();
			xmlDoc = parser.parseFromString(xmlhttp.responseText, "text/xml");
			var xxx = new x3d();
			model = xxx.getScene(xmlDoc);
			scene = new Object3D();
			scene.addChild(model);
			scene.reset(0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0);
			scene.update(canvas.width / 2,canvas.width,canvas.height);
			scene.paint(gc);
		}
	}
  xmlhttp.open(method, url, true);
  xmlhttp.send();
}

function initScene() {
	outLog = document.getElementById("outLog");
	canvas = document.getElementById("outputCanvas");
	gc = canvas.getContext("2d");

	var getUrl = "http://127.0.0.1/x3d/plane.x3d";
	outLog.innerHTML = "<b>Loading </b>" + getUrl + "<br>";
	doAjaxQuery("GET", getUrl);
}

</script>
</head>


<body onLoad="initScene()">

<center><h1>mini3D on HTML5 canvas</h1></center>

<hr/>

<center>
<canvas id="outputCanvas" width="480" height="320" 
  onmousedown="mousedown(event)"
  onmousemove="mousemove(event)"
  onmouseup="mouseup(event)"
  onmouseout="mouseup(event)"
  >
</canvas>
</center>

<hr/>
<div id="outLog"></div>
</body>
</html>
