<html>

<head>
<title>mini3D</title>
<link rel="stylesheet" type="text/css" href="/css/luc.css" />
</head>

<script type="text/javascript" src="matrix.js"></script>
<script type="text/javascript" src="vector.js"></script>
<script type="text/javascript" src="matrix3D.js"></script>
<script type="text/javascript" src="vector3D.js"></script>
<script type="text/javascript" src="mesh.js"></script>
<script type="text/javascript" src="object3D.js"></script>
<script type="text/javascript" src="box.js"></script>
<script type="text/javascript" src="polySphere.js"></script>
<script type="text/javascript" src="polyCylinder.js"></script>
<script type="text/javascript" src="polyCone.js"></script>

<script type="text/javascript">

function writeToOutputZone() {
	var i = 0;
	while (i < arguments.length) {
		document.getElementById('outputZone').innerHTML += arguments[i];
		i++;
	}
}

function writelnToOutputZone() {
	var i = 0;
	while (i < arguments.length) {
		document.getElementById('outputZone').innerHTML += arguments[i];
		i++;
	}
	document.getElementById('outputZone').innerHTML += "<br/>";
}

function runScript(inText) {
	clearZones();
	var evalText = inText.replace(/document\.writeln/g,"writelnToOutputZone");
	evalText = evalText.replace(/document\.write/g,"writeToOutputZone");
	eval(evalText);
}

function clearZones() {
	document.getElementById('outputZone').innerHTML = "";
	var canvas = document.getElementById("outputCanvas");
	canvas.width = canvas.width; // force erase
}

</script>

<body>

<center><h1>mini3D on HTML5 canvas</h1></center>

<hr/>

<center>
<canvas id="outputCanvas" width="480" height="320"></canvas>
</center>

<hr/>

<form>

<center>
<textarea id="sourceTextArea" rows="20" cols="80">

var canvas = document.getElementById("outputCanvas");
var gc = canvas.getContext("2d");

gc.strokeRect(0,0,canvas.width,canvas.height);

var nb,total,focal,cw,ch,r,h,w,d,fx,fr;
cw=canvas.width; ch=canvas.height;
focal = canvas.width / 2;

document.writeln("Canvas: ", canvas, " ", cw, "x", ch, " gc: ", gc);

w=60; h=20; d=30; fx=1;

var scene, obj;
scene = new Object3D();

obj = new Box(w, h, d, fx);
obj.color = "#FF00FF";
obj.reset(-200, 0, 300, 0, 0, 0, Math.PI / 6, Math.PI / 3, -Math.PI / 6, 0, 0, 0);
//obj.update(focal,cw,ch);
//obj.paint(gc);
document.writeln("Objet ", obj.mesh.nVertex, " sommets ", obj.mesh.nEdge, " arcs");
scene.addChild(obj);

total = nb = 9;
r=w/2;
fr=1;

obj = new PolySphere(total, nb, r*3, fr);
obj.color = "#FF0000";
obj.reset(-60, 40, 250, 0, 0, 0, Math.PI / 6, Math.PI / 3, -Math.PI / 6, 0, 0, 0);
//obj.update(focal,cw,ch);
//obj.paint(gc);
document.writeln("Objet ", obj.mesh.nVertex, " sommets ", obj.mesh.nEdge, " arcs");
scene.addChild(obj);

obj = new PolyCone(total, nb, h, r)
obj.color = "#00FF00";
obj.reset(60, -40, 200, 0, 0, 0, Math.PI / 6, Math.PI / 3, -Math.PI / 6, 0, 0, 0);
//obj.update(focal,cw,ch);
//obj.paint(gc);
document.writeln("Objet ", obj.mesh.nVertex, " sommets ", obj.mesh.nEdge, " arcs");
scene.addChild(obj);

obj = new PolyCylinder(total, nb, h, r)
obj.color = "#0000FF";
obj.reset(200, 0, 350, 0, 0, 0, Math.PI / 6, Math.PI / 3, -Math.PI / 6, 0, 0, 0);
//obj.update(focal,cw,ch);
//obj.paint(gc);
document.writeln("Objet ", obj.mesh.nVertex, " sommets ", obj.mesh.nEdge, " arcs");
scene.addChild(obj);

scene.reset(0, 0, 100, 0, Math.PI, 0, 0, 0, 0, 0, 0, 0);
scene.update(focal,cw,ch);
scene.paint(gc);
document.writeln("Scene ", scene.nChild, " sous objets.");

var nbTrans = 10;
while (nbTrans > 0) { 
  scene.transformation = 
    scene.transformation.mul(
      new Matrix3D().translation(0,0,300));
  scene.update(focal,cw,ch);
  scene.paint(gc);  
  nbTrans--;
}


</textarea>
</center>

<br/>

<input type="button" value="ex&eacute;cuter"
	onclick="runScript(document.getElementById('sourceTextArea').value,document.getElementById('outputZone'))" />
<input type="reset" value="effacer" onclick="clearZones()"/>
	
</form>

<hr/>

<div id="outputZone"></div>

</body>
</html>

