<html>

<head>
<title>gllimpx</title>

<script type="text/javascript" src="gllimpx.js"></script>

<script type="text/javascript">

var scene, model, canvas, gc, outLog, xmlDoc, xmlhttp;

var deltaZ, dragX, dragY;

function mousedown(event) {
	dragX = event.clientX;
	dragY = event.clientY;
}

function mousemove(event) {
  if (scene && model && dragX && dragY) {
	var deltaX = (event.clientX - dragX) * 2 * Math.PI / canvas.width;
	var deltaY = (dragY - event.clientY) * 2 * Math.PI / canvas.height;
	model.transformation = model.transformation.mul(
		Matrix3D.rotationY(deltaX).mul(
			Matrix3D.rotationX(deltaY)));
  	scene.update(canvas.width / 2,canvas.width,canvas.height);
  	gc.clearRect(0,0,canvas.width,canvas.height);
  	scene.paint(gc);  
	dragX = event.clientX;
	dragY = event.clientY;
  }
}

function mouseup(event) {
	dragX = dragY = 0;
}

function doAjaxQuery(method, url) {
  xmlhttp=new XMLHttpRequest();
  xmlhttp.onreadystatechange=function() {
		if (xmlhttp.readyState==4 && xmlhttp.status==200) {
			var parser=new DOMParser();
			xmlDoc = parser.parseFromString(xmlhttp.responseText, "text/xml");
			var xxx = new x3d();
			model = xxx.getScene(xmlDoc);
			scene = new Object3D();
			scene.addChild(model);
			scene.reset(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0);
			scene.update(canvas.width / 2,canvas.width,canvas.height);
			scene.paint(gc);
		}
	}
  xmlhttp.open(method, url, true);
  xmlhttp.send();
}

function initScene(getUrl) {
	outLog = document.getElementById("outLog");
	canvas = document.getElementById("outputCanvas");
	gc = canvas.getContext("2d");
	doAjaxQuery("GET", getUrl);
}

</script>
</head>


<body>

<center><h1>gllimpx</h1></center>

<hr/>

<center>
<canvas id="outputCanvas" width="480" height="320" 
  onmousedown="mousedown(event)"
  onmousemove="mousemove(event)"
  onmouseup="mouseup(event)"
  onmouseout="mouseup(event)"
  >
</canvas>
</center>

<hr/>
<form>
  <input type="button" value="Load" onClick="initScene(modelUrl.value)"/>
  <input type="text" name="modelUrl"/>
</form>

</body>
</html>
